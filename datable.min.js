// datable.js by invot
// version 0.4.3

!function(e){e.fn.datable=function(){function a(e,a){for(var t={},r=0;r<e.length;r++)t[e[r]]=a[r];return t}function t(e,a,t){var r=new Date(e,a-1,t);return r.getFullYear()==e&&r.getMonth()==a-1&&r.getDate()==t?!0:!1}function r(a){if(e.isArray(a)){var t=new Date;return day=parseInt(t.getDate())+parseInt(a[2]),month=parseInt(t.getMonth()+1)+parseInt(a[1]),year=parseInt(t.getFullYear())+parseInt(a[0]),new Date(year,month,day)}return new Date(a)}function n(e,a){for(var t=[],r=-1;(r=a.indexOf(e,r+1))>=0;)t.push(r);return t}e(this).each(function(){var l=e(this),o=l.data("datable"),s=l.data("datable-era2"),d=l.data("datable-era"),y=o.match(/.{2}/g),i=[],h=l.data("datable-divider"),u=h?h:" / ",v=d?r(d):null,p=s?r(s):new Date;e.each(y,function(a,t){-1===e.inArray(t,i)?i.push(t):(i.pop(),i.push(t+t))});var f=i.join(u).toUpperCase();l.attr("maxlength",f.length),l.attr("placeholder",f).val(),l.on("keydown",function(a){if((a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&-1===e.inArray(a.keyCode,[46,8,9,27,13,37,39])&&a.preventDefault(),8==a.keyCode)-1!==l.val().indexOf(u,l.val().length-u.length)&&(l.val(l.val().replace(new RegExp(u+"$"),"")),a.preventDefault());else if(a.keyCode>36&&a.keyCode<41);else{var t=this.selectionStart,r=(l.val().length,n(u,f)),o=l.val().substring(t,parseInt(t)+u.length);o!=u||e.inArray(t,r)?-1!==e.inArray(t,r)&&l.val().length<f.length&&l.val(l.val()+u):this.selectionStart=l.val().length}}),l.on("blur",function(){var e=l.val().split(u),r=a(i,e),n=0;if(r.yy&&(r.yyyy=2e3+parseInt(r.yy)),r.dd||(r.dd=1),r.mm||(r.mm=1),t(r.yyyy,r.mm,r.dd)){var o=new Date(r.yyyy,r.mm,r.dd);v&&(v>o&&p>o||o>v&&o>p)&&n++}else n++;0!==l.val().length&&n?l.addClass("error").closest(".control-group").addClass("has-error"):l.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);